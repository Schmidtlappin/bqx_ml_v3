{
  "entities": {
    "CurrencyPair": {
      "definition": "Trading pair of two currencies (e.g., EURUSD)",
      "count": 28,
      "attributes": ["base_currency", "quote_currency", "model_id", "dataset_tables"],
      "relationships": {
        "has_model": "One-to-One with Model (PLANNED - not yet trained)",
        "generates_data": "One-to-Many with BarData",
        "produces_predictions": "One-to-Many with Prediction (PENDING model training)"
      }
    },
    "Model": {
      "definition": "Machine learning model ensemble for specific currency pair and horizon",
      "architecture_version": "2.0 - Enhanced Stacking",
      "ensemble_members": ["LightGBM", "XGBoost", "CatBoost", "ElasticNet"],
      "meta_learner": "Logistic Regression + Regime Features",
      "count": 0,
      "planned_count": 784,
      "breakdown": "28 pairs × 7 horizons × 4 ensemble members",
      "horizons": ["h15", "h30", "h45", "h60", "h75", "h90", "h105"],
      "attributes": ["model_type", "pair_id", "horizon", "ensemble_role", "training_date", "performance_metrics", "calibration_method"],
      "accuracy_target": {
        "overall": "85-90%",
        "called_signals": "90-95%",
        "coverage": "30-50%"
      },
      "deployment_strategy": "Deploy farthest horizon achieving ≥95% called accuracy",
      "stacking_architecture": {
        "stage_a": "Sign Probability Stack (calibrated P(+))",
        "stage_b": "Conditional Magnitude (after sign decided)"
      },
      "critical_fixes_v2": [
        "Walk-forward OOF predictions (prevents leakage)",
        "Probability calibration (Platt scaling)",
        "Regime-aware meta-learner",
        "Feature-view diversity",
        "Confidence gating"
      ],
      "status": "IN PROGRESS - Feature selection complete, awaiting training",
      "relationships": {
        "belongs_to_pair": "Many-to-One with CurrencyPair",
        "trained_on": "Many-to-Many with Feature",
        "produces": "One-to-Many with Prediction"
      }
    },
    "Feature": {
      "definition": "Input variable for model training and prediction",
      "total_types": 20,
      "feature_type_prefixes": {
        "pair_level": {
          "agg": "Aggregation - statistical summaries (mean, std, min, max)",
          "mom": "Momentum - rate of change, acceleration, persistence",
          "vol": "Volatility - ATR, realized vol, Bollinger metrics",
          "reg": "Regression - polynomial trends and predictions",
          "regime": "Regime - market state classification",
          "lag": "Lag - historical values (1-60 bars)",
          "align": "Alignment - cross-timeframe coherence",
          "der": "Derivative - velocity and acceleration",
          "rev": "Reversal - reversal detection patterns",
          "div": "Divergence - cross-window divergence",
          "mrt": "Mean Reversion - tension and z-scores",
          "cyc": "Cycle - cycle position and phase (BQX only)",
          "ext": "Extremity - outlier detection (BQX only)",
          "tmp": "Temporal - time-of-day and session",
          "base": "Base - OHLCV fundamentals",
          "var": "Variance - volatility regime features"
        },
        "cross_pair": {
          "cov": "Covariance - cross-pair co-movement",
          "corr": "Correlation - cross-pair relationships",
          "tri": "Triangulation - triangular arbitrage"
        },
        "market_wide": {
          "mkt": "Market - global FX aggregations"
        },
        "currency_level": {
          "csi": "Currency Strength Index - per-currency aggregations (MISSING)"
        }
      },
      "implemented_types": ["cov", "corr", "lag", "tri", "regime", "agg", "align", "mom", "der", "rev", "vol", "mrt", "div", "reg", "base", "cyc", "ext", "tmp"],
      "partial_types": ["var", "mkt"],
      "missing_types": ["csi"],
      "total_tables": 4888,
      "features_per_pair": 6477,
      "features_breakdown": {
        "pair_specific": 3813,
        "cross_pair_tri": 2088,
        "market_wide_mkt": 576,
        "note": "Corrected 2025-12-09: 3,813 was pair-specific only"
      },
      "attributes": ["feature_name", "feature_type", "calculation_method", "lag_periods"],
      "variants": ["IDX (price-based)", "BQX (momentum-based)"],
      "dual_architecture_status": "100% for implemented types",
      "catalogue": "/intelligence/feature_catalogue.json",
      "ledger": {
        "mandate": "/mandate/FEATURE_LEDGER_100_PERCENT_MANDATE.md",
        "mandate_date": "2025-12-09",
        "coverage_requirement": "100% per model",
        "expected_rows": 1269492,
        "calculation": "28 pairs × 7 horizons × 6,477 features"
      },
      "relationships": {
        "used_by": "Many-to-Many with Model (PENDING)",
        "derived_from": "Many-to-One with BarData"
      }
    },
    "Target": {
      "definition": "Prediction objective (future BQX values at prediction horizons)",
      "mandate": "/mandate/BQX_TARGET_FORMULA_MANDATE.md",
      "mandate_date": "2025-12-09",
      "bqx_windows": ["bqx_45", "bqx_90", "bqx_180", "bqx_360", "bqx_720", "bqx_1440", "bqx_2880"],
      "prediction_horizons": ["h15", "h30", "h45", "h60", "h75", "h90", "h105"],
      "target_columns_per_pair": 49,
      "naming_convention": "target_bqx{window}_h{horizon}",
      "formula": {
        "canonical": "LEAD(bqx_{window}, horizon)",
        "meaning": "The BQX value N intervals into the future",
        "example": "target_bqx45_h15 = LEAD(bqx_45, 15)"
      },
      "critical_requirements": {
        "bqx_must_oscillate_around_zero": true,
        "target_must_equal_lead_bqx": true,
        "windows_and_horizons_are_independent": true
      },
      "verification": {
        "targets_eurusd": "100% match (2,164,270 rows)",
        "verification_date": "2025-12-09"
      },
      "attributes": ["target_name", "horizon", "bqx_window", "prediction_time"],
      "status": "VERIFIED - targets_eurusd ready for training",
      "relationships": {
        "predicted_by": "Many-to-One with Model (PENDING)",
        "validates_against": "One-to-One with ActualBQX"
      }
    },
    "BarData": {
      "definition": "OHLCV candlestick data point (1-minute intervals)",
      "source": "m1_* tables in bqx_bq_uscen1 dataset",
      "row_count_per_pair": "~2.17M (6 years of data)",
      "attributes": ["timestamp", "open", "high", "low", "close", "volume", "pair_id"],
      "relationships": {
        "belongs_to": "Many-to-One with CurrencyPair",
        "generates": "One-to-Many with Feature"
      }
    },
    "Prediction": {
      "definition": "Model output predicting future BQX values",
      "count": 0,
      "status": "NOT STARTED - pending model training",
      "attributes": ["prediction_time", "horizon", "predicted_value", "confidence", "model_id"],
      "relationships": {
        "made_by": "Many-to-One with Model (PENDING)",
        "for_pair": "Many-to-One with CurrencyPair"
      }
    },
    "Stage": {
      "definition": "Project plan stage in AirTable",
      "count": 70,
      "attributes": ["stage_id", "name", "description", "score", "status"],
      "relationships": {
        "belongs_to": "Many-to-One with Phase",
        "part_of": "Many-to-One with Plan"
      }
    },
    "Phase": {
      "definition": "Project plan phase grouping related stages",
      "count": 11,
      "completed_phases": ["Phase 0", "Phase 1", "Phase 1B"],
      "attributes": ["phase_id", "name", "description", "score"],
      "relationships": {
        "contains": "One-to-Many with Stage",
        "part_of": "Many-to-One with Plan"
      }
    }
  },
  "relationships": {
    "hierarchical": {
      "Plan": ["Phase", "Stage"],
      "CurrencyPair": ["Model (pending)", "BarData", "Prediction (pending)"],
      "Model": ["Prediction (pending)"]
    },
    "computational": {
      "BarData → IDX": "Price normalization to base=100",
      "IDX → BQX": "Momentum calculation (percentage change over lookback)",
      "IDX/BQX → Features": "Lag, regime, correlation extraction",
      "Features → Model": "Training and prediction input (PENDING)",
      "Model → Prediction": "Inference and output generation (PENDING)",
      "Prediction → Validation": "Performance measurement (PENDING)"
    }
  },
  "data_flow": {
    "ingestion": "Market Data → m1_* tables → BigQuery bqx_bq_uscen1",
    "indexing": "m1_* → {pair}_idx (price normalization)",
    "momentum": "{pair}_idx → {pair}_bqx (BQX calculation)",
    "feature_engineering": "IDX/BQX → Feature Tables (lag_*, regime_*, corr_*)",
    "training": "Features + Targets → Model Training → Trained Model (PENDING)",
    "prediction": "Latest Features → Inference → BQX Predictions (PENDING)",
    "validation": "Predictions vs Actuals → Performance Metrics (PENDING)"
  },
  "storage_hierarchy": {
    "BigQuery": {
      "location": "us-central1",
      "migration_date": "2025-12-08",
      "migration_status": "V2 COMPLETE (100%)",
      "full_catalog": "/intelligence/bigquery_v2_catalog.json",
      "partitioning": "DATE(interval_time)",
      "clustering": "pair (or pair1 for covariance tables)",
      "datasets_v2": {
        "bqx_bq_uscen1_v2": {
          "description": "Source data - partitioned, clustered",
          "tables": 2210,
          "size_gb": 131.04,
          "status": "100% COMPLETE",
          "pattern": "{pair}_m1, {pair}_idx, {pair}_bqx"
        },
        "bqx_ml_v3_features_v2": {
          "description": "Engineered features - partitioned, clustered",
          "tables": 4888,
          "size_gb": 1478.69,
          "status": "98% COMPLETE (gaps: csi, var, mkt)",
          "feature_types_count": 20,
          "feature_types": {
            "complete": ["cov", "corr", "lag", "tri", "regime", "agg", "align", "mom", "der", "rev", "vol", "mrt", "div", "reg", "base", "cyc", "ext", "tmp"],
            "partial": ["var", "mkt"],
            "missing": ["csi"]
          },
          "gaps": {
            "csi": "0/208 tables (MISSING)",
            "var": "55/114 tables (PARTIAL)",
            "mkt": "4/18 tables (PARTIAL)"
          }
        },
        "bqx_ml_v3_analytics_v2": {
          "description": "Target tables for training",
          "tables": 54,
          "size_gb": 68.34,
          "status": "ACTIVE"
        },
        "bqx_ml_v3_models": {
          "description": "Trained model artifacts",
          "tables": 16,
          "status": "READY - V2 migration complete"
        },
        "bqx_ml_v3_predictions": {
          "description": "Model prediction outputs",
          "tables": 1,
          "status": "PENDING"
        }
      },
      "datasets_v1_deleted": {
        "bqx_bq_uscen1": "DELETED 2025-12-09 (was 1,220 GB)",
        "bqx_ml_v3_features": "DELETED 2025-12-09 (was 1,279 GB)"
      },
      "storage_totals": {
        "v2_total_gb": 1694,
        "breakdown": {
          "bqx_ml_v3_features_v2": "1,575.84 GB (5,048 tables)",
          "bqx_ml_v3_analytics_v2": "75.13 GB (56 tables)",
          "bqx_bq_uscen1_v2": "43.01 GB (2,313 tables)"
        },
        "monthly_cost": "$33.88",
        "savings_realized": "$49.98/month",
        "f3b_cleanup": "56 duplicates deleted, 45 orphans retained",
        "updated": "2025-12-10"
      }
    },
    "Training_Platform": {
      "primary": "BigQuery ML (cost-optimized)",
      "alternative": "Vertex AI (for complex ensembles)",
      "models_planned": 784,
      "models_trained": 0,
      "structure": "28 pairs × 7 horizons × 4 ensemble members",
      "status": "READY - V2 migration complete"
    }
  }
}
