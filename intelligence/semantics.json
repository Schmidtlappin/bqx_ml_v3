{
  "core_concepts": {
    "BQX": {
      "definition": "Proprietary momentum indicator measuring percentage change over lookback period",
      "purpose": "Primary target for prediction AND feature for autoregressive modeling",
      "components": ["bqx_45", "bqx_90", "bqx_180", "bqx_360", "bqx_720", "bqx_1440", "bqx_2880"],
      "paradigm_shift": "BQX values can now be used as BOTH features AND targets (since 2024-11-24)",
      "calculation": "((current_close - lag_close) / lag_close) * 100",
      "status": "Implemented in all 28 {pair}_bqx tables"
    },
    "IDX": {
      "definition": "Indexed price data normalized to base=100",
      "purpose": "Price-based features for model training",
      "calculation": "(current_close / base_close) * 100",
      "status": "Implemented in all 28 {pair}_idx tables",
      "row_count": "~2.17M per pair (6 years)"
    },
    "Dual_Architecture": {
      "definition": "All features exist in both IDX and BQX variants",
      "implemented_types": ["LAG", "REGIME"],
      "pending_types": ["REGRESSION", "AGGREGATION", "ALIGNMENT", "MOMENTUM", "VOLATILITY"],
      "status": "100% complete for implemented types (as of 2025-11-28)",
      "rationale": "Models learn from both price patterns (IDX) and momentum patterns (BQX)"
    },
    "Interval_Centric": {
      "definition": "All calculations use row-based windows (ROWS BETWEEN) instead of time-based",
      "rationale": "Ensures consistent sample sizes regardless of data gaps",
      "implementation": "ROWS BETWEEN N PRECEDING AND CURRENT ROW",
      "forbidden": "Any time-based windows (e.g., INTERVAL, date arithmetic)",
      "status": "Applied to all feature calculations"
    },
    "Independent_Models": {
      "definition": "Each currency pair-horizon has its own isolated model ensemble",
      "count_planned": 588,
      "count_trained": 0,
      "breakdown": "28 pairs × 7 horizons × 3 ensemble members (ElasticNet removed per EA-001)",
      "horizons": ["h15", "h30", "h45", "h60", "h75", "h90", "h105"],
      "ensemble_members": ["LightGBM", "XGBoost", "CatBoost"],
      "meta_learner": "LogisticRegression (regime-aware)",
      "isolation": "Complete - no feature or data sharing between pairs",
      "rationale": "Each pair has unique dynamics requiring specialized modeling",
      "accuracy_target": "85-95% called accuracy",
      "deployment_strategy": "Deploy farthest horizon achieving ≥95% per pair",
      "feature_universe": {
        "total_columns_per_pair": 11337,
        "unique_features_per_pair": 1064,
        "tables_per_pair": 462
      },
      "current_h15_model": {
        "features": 59,
        "status": "OBSOLETE - will be replaced after full universe testing"
      },
      "status": "IN PROGRESS - Step 6 feature extraction running"
    },
    "Feature_Target_Separation": {
      "old_rule": "BQX values strictly prohibited as features",
      "new_rule": "BQX values can be features (lags) AND targets (forward predictions)",
      "features": "Historical (backward-looking) data including BQX lags",
      "targets": "Future (forward-looking) BQX predictions",
      "implementation_date": "2024-11-24 paradigm shift"
    },
    "BQX_Target_Formula": {
      "mandate_document": "/mandate/BQX_TARGET_FORMULA_MANDATE.md",
      "mandate_date": "2025-12-09",
      "mandate_status": "USER MANDATED - AUTHORITATIVE",
      "bqx_feature_formula": {
        "canonical": "bqx_{window} = ((close[T] - close[T-window]) / close[T-window]) * 100",
        "sql": "((close_idx - LAG(close_idx, window) OVER (ORDER BY interval_time)) / NULLIF(LAG(close_idx, window) OVER (ORDER BY interval_time), 0)) * 100",
        "purpose": "Backward-looking momentum (percentage change over lookback period)",
        "windows": [45, 90, 180, 360, 720, 1440, 2880],
        "data_characteristics": {
          "avg": "~0.0001 (oscillates around zero)",
          "min": "-1.63",
          "max": "+2.04",
          "stddev": "0.087"
        }
      },
      "target_formula": {
        "canonical": "target_bqx{window}_h{horizon} = LEAD(bqx_{window}, horizon)",
        "sql": "LEAD(bqx_{window}, horizon) OVER (ORDER BY interval_time)",
        "purpose": "Future BQX value at prediction horizon",
        "horizons": [15, 30, 45, 60, 75, 90, 105],
        "total_targets_per_pair": 49,
        "calculation": "7 BQX windows × 7 prediction horizons"
      },
      "critical_distinction": {
        "bqx_windows": "Lookback periods for calculating momentum (45, 90, 180, 360, 720, 1440, 2880)",
        "prediction_horizons": "How far ahead we're predicting (h15, h30, h45, h60, h75, h90, h105)",
        "warning": "These are SEPARATE concepts - do NOT conflate them"
      },
      "verification": {
        "date": "2025-12-09",
        "table": "targets_eurusd",
        "total_rows": 2164270,
        "matching_rows": 2164270,
        "match_rate": "100%"
      }
    }
  },
  "terminology": {
    "Lag": "Historical value N bars ago (e.g., close_lag_1, bqx_lag_1)",
    "Lead": "Future value N bars ahead (used for target calculation)",
    "Regime": "Market state categorization (trending, ranging, volatile, calm)",
    "Centric": "Calculation perspective (Primary, Variant, Covariant, Triangulation, Secondary, Tertiary)",
    "Cell_Type": "Unique combination of feature × centric × variant",
    "Table": "BigQuery table containing specific feature set for a currency pair",
    "Stage": "Project plan stage in AirTable (70 total)",
    "Phase": "Project plan phase in AirTable (11 total)",
    "m1": "1-minute bar data (OHLCV)",
    "idx": "Indexed price data (normalized to base=100)",
    "bqx": "Backward momentum (percentage change over lookback)"
  },
  "feature_categories": {
    "Price_Features": {
      "base": ["open", "high", "low", "close", "volume"],
      "derived": ["returns", "log_returns", "volatility", "range"],
      "lags": "1-60 bars historical",
      "status": "Available in m1_* and idx_* tables"
    },
    "BQX_Features": {
      "base": ["bqx_45", "bqx_90", "bqx_180", "bqx_360", "bqx_720", "bqx_1440", "bqx_2880"],
      "derived": ["bqx_momentum", "bqx_volatility", "bqx_regime"],
      "lags": "1-60 bars historical (NEW - paradigm shift!)",
      "status": "Implemented in lag_bqx_* and regime_bqx_* tables (56 + 56 = 112 tables)"
    },
    "LAG_Features": {
      "idx_variant": "56 tables (lag_{pair}_45, lag_{pair}_90)",
      "bqx_variant": "56 tables (lag_bqx_{pair}_45, lag_bqx_{pair}_90)",
      "status": "100% complete",
      "completion_date": "2025-11-28"
    },
    "REGIME_Features": {
      "idx_variant": "56 tables (regime_{pair}_45, regime_{pair}_90)",
      "bqx_variant": "56 tables (regime_bqx_{pair}_45, regime_bqx_{pair}_90)",
      "categories": ["HIGH_VOL", "LOW_VOL", "NORMAL", "STRONG_UP", "STRONG_DOWN", "RANGING"],
      "status": "100% complete",
      "completion_date": "2025-11-28"
    },
    "CORRELATION_Features": {
      "fx_correlation": "168 tables (corr_{pair1}_{pair2})",
      "ibkr_correlation": "56 tables (corr_{pair}_{instrument})",
      "total": "224 tables",
      "status": "100% complete",
      "completion_date": "2025-11-28",
      "note": "Single-variant only (no BQX variant needed for correlation)"
    },
    "REGRESSION_Features": {
      "status": "COMPLETE",
      "actual_tables": 84,
      "breakdown": "28 bqx + 28 idx + 28 other variants",
      "completion_date": "2025-12-08",
      "note": "Updated 2025-12-09 from BQ audit"
    },
    "AGGREGATION_Features": {
      "status": "COMPLETE",
      "actual_tables": 84,
      "breakdown": "28 bqx + 28 idx + 28 other variants",
      "completion_date": "2025-12-08",
      "note": "Updated 2025-12-09 from BQ audit"
    },
    "ALIGNMENT_Features": {
      "status": "COMPLETE",
      "actual_tables": 84,
      "breakdown": "28 bqx + 28 idx + 28 other variants",
      "completion_date": "2025-12-08",
      "note": "Updated 2025-12-09 from BQ audit"
    },
    "MOMENTUM_Features": {
      "status": "COMPLETE",
      "actual_tables": 84,
      "breakdown": "28 bqx + 28 idx + 28 other variants",
      "completion_date": "2025-12-08",
      "note": "Updated 2025-12-09 from BQ audit"
    },
    "VOLATILITY_Features": {
      "status": "COMPLETE",
      "actual_tables": 84,
      "breakdown": "28 bqx + 28 idx + 28 other variants",
      "completion_date": "2025-12-08",
      "note": "Updated 2025-12-09 from BQ audit"
    },
    "DERIVATIVE_Features": {
      "status": "COMPLETE",
      "actual_tables": 84,
      "breakdown": "28 bqx + 28 idx + 28 other variants",
      "completion_date": "2025-12-08"
    },
    "REVERSAL_Features": {
      "status": "COMPLETE",
      "actual_tables": 84,
      "breakdown": "28 bqx + 28 idx + 28 other variants",
      "completion_date": "2025-12-08"
    },
    "DIVERGENCE_Features": {
      "status": "COMPLETE",
      "actual_tables": 84,
      "breakdown": "28 bqx + 28 idx + 28 other variants",
      "completion_date": "2025-12-08"
    },
    "MEAN_REVERSION_Features": {
      "status": "COMPLETE",
      "actual_tables": 84,
      "breakdown": "28 bqx + 28 idx + 28 other variants",
      "completion_date": "2025-12-08"
    },
    "CYCLE_Features": {
      "status": "COMPLETE",
      "actual_tables": 28,
      "breakdown": "BQX-only by design",
      "completion_date": "2025-12-08"
    },
    "EXTREMITY_Features": {
      "status": "COMPLETE",
      "actual_tables": 28,
      "breakdown": "BQX-only by design",
      "completion_date": "2025-12-08"
    },
    "TEMPORAL_Features": {
      "status": "COMPLETE",
      "actual_tables": 28,
      "breakdown": "Per-pair temporal patterns",
      "completion_date": "2025-12-08"
    },
    "CSI_Features": {
      "status": "COMPLETE",
      "expected_tables": 144,
      "actual_tables": 144,
      "gap": 0,
      "mandate_reference": "/mandate/BQX_ML_V3_FEATURE_INVENTORY.md Section 5",
      "note": "CE REVISED 2025-12-09: 144 tables achievable (IDX sources unavailable for cyc, ext, lag, div). BA completed 100%.",
      "feature_types_with_idx": ["agg", "mom", "vol", "reg", "align", "der", "rev", "mrt"],
      "feature_types_bqx_only": ["cyc", "ext", "lag", "div"],
      "completion_date": "2025-12-09"
    },
    "COVARIANCE_Features": {
      "prefix": "cov",
      "status": "COMPLETE",
      "actual_tables": 2507,
      "breakdown": "Cross-pair covariance matrices",
      "completion_date": "2025-12-08",
      "category": "cross_pair"
    },
    "TRIANGULATION_Features": {
      "prefix": "tri",
      "status": "COMPLETE",
      "actual_tables": 194,
      "breakdown": "Triangular arbitrage relationships",
      "completion_date": "2025-12-08",
      "category": "cross_pair"
    },
    "BASE_Features": {
      "prefix": "base",
      "status": "COMPLETE",
      "actual_tables": 56,
      "breakdown": "28 bqx + 28 idx",
      "completion_date": "2025-12-08",
      "category": "pair_level"
    },
    "VARIANCE_Features": {
      "prefix": "var",
      "status": "COMPLETE",
      "expected_tables": 63,
      "actual_tables": 63,
      "gap": 0,
      "category": "pair_level",
      "completion_date": "2025-12-09",
      "note": "Phase 1.5 GATE_1 complete"
    },
    "MARKET_Features": {
      "prefix": "mkt",
      "status": "COMPLETE",
      "expected_tables": 12,
      "actual_tables": 12,
      "gap": 0,
      "category": "market_wide",
      "completion_date": "2025-12-09",
      "note": "Phase 1.5 GATE_1 complete"
    }
  },
  "feature_type_summary": {
    "total_types": 20,
    "complete": 20,
    "partial": 0,
    "missing": 0,
    "gate_1_complete": "2025-12-09",
    "by_category": {
      "pair_level": ["agg", "mom", "vol", "reg", "regime", "lag", "align", "der", "rev", "div", "mrt", "cyc", "ext", "tmp", "base", "var"],
      "cross_pair": ["cov", "corr", "tri"],
      "market_wide": ["mkt"],
      "currency_level": ["csi"]
    },
    "catalogue_reference": "/intelligence/feature_catalogue.json"
  },
  "model_types": {
    "base_algorithms": [
      "LightGBM",
      "XGBoost",
      "CatBoost"
    ],
    "meta_learner": "LSTM or Logistic Regression",
    "ensemble_strategy": "Stacking: 3 base learners → Meta-learner",
    "total_models_planned": 784,
    "total_models_trained": 0,
    "breakdown": "28 pairs × 7 horizons × 4 ensemble members",
    "horizons": [15, 30, 45, 60, 75, 90, 105],
    "horizon_definition": "7 prediction horizons at 15-interval increments (h15 through h105)",
    "horizon_targets": "Each model predicts bqx_* values N intervals into the future",
    "deployment_strategy": "Deploy FARTHEST horizon achieving ≥95% accuracy per pair",
    "accuracy_target": "95%+ directional accuracy",
    "critical_distinction": "These are PREDICTION horizons (forward-looking), NOT BQX calculation windows (backward-looking)",
    "validation": "Walk-forward validation (MANDATORY for time series)",
    "feature_selection": "SHAP values for top 500-1,000 features",
    "status": "PENDING - V2 migration must complete first"
  },
  "data_pipeline_stages": {
    "ingestion": {
      "description": "Raw market data → m1_* tables",
      "status": "COMPLETE",
      "tables": 804
    },
    "indexing": {
      "description": "Price normalization → {pair}_idx tables",
      "status": "COMPLETE",
      "tables": 28
    },
    "momentum": {
      "description": "BQX calculation → {pair}_bqx tables",
      "status": "COMPLETE (regenerated 2025-11-28)",
      "tables": 28
    },
    "lag": {
      "description": "Historical feature calculation → lag_* tables",
      "status": "COMPLETE",
      "tables": 112
    },
    "regime": {
      "description": "Market state classification → regime_* tables",
      "status": "COMPLETE",
      "tables": 112
    },
    "correlation": {
      "description": "Cross-pair relationships → corr_* tables",
      "status": "COMPLETE",
      "tables": 224
    },
    "regression": {
      "description": "Polynomial trends and predictions",
      "status": "COMPLETE",
      "actual_tables": 84,
      "note": "Updated 2025-12-09 from BQ audit"
    },
    "aggregation": {
      "description": "Statistical summaries across windows",
      "status": "COMPLETE",
      "actual_tables": 84,
      "note": "Updated 2025-12-09 from BQ audit"
    },
    "alignment": {
      "description": "Cross-timeframe coherence",
      "status": "COMPLETE",
      "actual_tables": 84,
      "note": "Updated 2025-12-09 from BQ audit"
    },
    "momentum_advanced": {
      "description": "ROC, acceleration, persistence",
      "status": "COMPLETE",
      "actual_tables": 84,
      "note": "Updated 2025-12-09 from BQ audit"
    },
    "volatility": {
      "description": "ATR, realized vol, Bollinger metrics",
      "status": "COMPLETE",
      "actual_tables": 84,
      "note": "Updated 2025-12-09 from BQ audit"
    },
    "derivative": {
      "description": "Velocity, acceleration features",
      "status": "COMPLETE",
      "actual_tables": 84
    },
    "reversal": {
      "description": "Reversal detection features",
      "status": "COMPLETE",
      "actual_tables": 84
    },
    "divergence": {
      "description": "Cross-window divergence",
      "status": "COMPLETE",
      "actual_tables": 84
    },
    "mean_reversion": {
      "description": "Mean-reversion tension features",
      "status": "COMPLETE",
      "actual_tables": 84
    },
    "cycle": {
      "description": "Cycle position features",
      "status": "COMPLETE",
      "actual_tables": 28
    },
    "extremity": {
      "description": "Extremity metrics",
      "status": "COMPLETE",
      "actual_tables": 28
    },
    "temporal": {
      "description": "Temporal/session patterns",
      "status": "COMPLETE",
      "actual_tables": 28
    }
  },
  "quality_metrics": {
    "v2_migration_progress": "100% COMPLETE",
    "last_audit": "2025-12-09",
    "total_tables": 4888,
    "total_feature_columns": 86190,
    "features_per_pair_eurusd": 6477,
    "features_breakdown_eurusd": {
      "pair_specific": 3813,
      "cross_pair_tri": 2088,
      "market_wide_mkt": 576,
      "gaps_var_csi": 0,
      "total_current": 6477,
      "total_after_gaps": "~6567",
      "correction_note": "2025-12-09: Original 3,813 was pair-specific only, missed tri+mkt"
    },
    "source_v2_complete": "100% (2,210 tables)",
    "covariance_complete": "100% (2,507 tables)",
    "regime_complete": "100% (112 tables)",
    "dual_architecture": "100% for all feature types",
    "data_parity": "100% (IDX and BQX tables mirror each other)",
    "row_counts": "~2.17M per table (6 years of data)",
    "partitioning": "DATE(interval_time)",
    "clustering": "pair (or pair1 for covariance)",
    "models_trained": "0 of 784 (0%)",
    "accuracy_target": "95%+ called signal accuracy",
    "gaps_identified": {
      "csi_tables": "COMPLETE - 144/144 (CE finalized 2025-12-09: IDX unavailable for cyc/ext/lag/div)",
      "var_tables": "COMPLETE - 63/63",
      "mkt_tables": "COMPLETE - 12/12",
      "total_gap_target": 219,
      "total_remaining": 0,
      "breakdown": "CSI 144 + VAR 63 + MKT 12 = 219 ALL COMPLETE",
      "gate_1_passed": "2025-12-09",
      "last_updated": "2025-12-10T00:20"
    },
    "f3b_cleanup": {
      "date": "2025-12-10",
      "decision": "Option A - Conservative",
      "duplicates_deleted": 56,
      "orphans_retained": 45,
      "storage_freed_gb": 52,
      "monthly_savings": "$1.00",
      "orphan_review": "Deferred to Phase 4 (regime features evaluation)",
      "orphan_tables": ["reg_bqx (1)", "reg_corr_* (8)", "regime_* (36)"]
    },
    "feature_catalogue": "/intelligence/feature_catalogue.json"
  }
}
